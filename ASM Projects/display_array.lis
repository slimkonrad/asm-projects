     1                                  ; //****************************************************************************************************************************
     2                                  ; //* Program name: Arrays of floats                                                                                         *
     3                                  ; //* Copyright (C) 2025 Daniel Shively.                                                                                           *
     4                                  ; //* This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License  *
     5                                  ; //* version 3 as published by the Free Software Foundation. This program is distributed in the hope that it will be useful,   *
     6                                  ; //* but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See    *
     7                                  ; //* the GNU General Public License for more details. A copy of the GNU General Public License v3 is available here:            *
     8                                  ; //* https://www.gnu.org/licenses/.                                                                                           *
     9                                  ; //****************************************************************************************************************************
    10                                  
    11                                  ; //========1=========2=========3=========4=========5=========6=========7=========8=========9=========0=========1=========2=========3
    12                                  ; // Author information
    13                                  ; // Author: Daniel Shively
    14                                  ; // Author Email: danielshively36@gmail.com
    15                                  ; // CWID: 845182641
    16                                  ; //
    17                                  ; // Program information
    18                                  ; //   Program name: Sum of Values
    19                                  ; //   Programming languages: X86-64 Assembly
    20                                  ; //   Date program began: 2025-Sep-15
    21                                  ; //   Date of last update: 2025-Nov-02
    22                                  ; //   Files in this program: arithmetic.asm, adder.asm, get_numbers.asm, display_array.asm, ftoa.asm, getline.asm, getchar.asm,
    23                                  ; //   atof.asm, isfloat.asm, r.sh
    24                                  ; //   Status: Ready for release.
    25                                  ; //
    26                                  ; // Purpose
    27                                  ; //   This module displays the contents of the float array to the console.
    28                                  ; //
    29                                  ; // This file
    30                                  ; //   File name: display_array.asm
    31                                  ; //   Language: x86-64 Assembly (NASM)
    32                                  ; //   Compile: nasm -f elf64 -g -F dwarf -o display_array.o display_array.asm -l display_array.lis
    33                                  ; //   Purpose: Displays the array of floats.
    34                                  ; //========1=========2=========3=========4=========5=========6=========7=========8=========9=========0=========1=========2=========3
    35                                  
    36                                  global display_array
    37                                  
    38                                  extern ftoa
    39                                  
    40                                  segment .data
    41 00000000 0A00                        newline: db 0x0A, 0
    42                                  
    43                                  segment .text
    44                                  display_array:
    45                                      ; Prologue
    46 00000000 55                          push rbp
    47 00000001 4889E5                      mov rbp, rsp
    48 00000004 4154                        push r12
    49 00000006 4155                        push r13
    50 00000008 4156                        push r14
    51 0000000A 4157                        push r15                ; <<< FIX: Save r15 (clobbered by ftoa)
    52 0000000C 53                          push rbx
    53                                  
    54                                      ; rdi = array pointer
    55                                      ; rsi = count
    56 0000000D 4989FC                      mov r12, rdi                ; array
    57 00000010 4989F5                      mov r13, rsi                ; count
    58 00000013 41BE00000000                mov r14, 0                  ; index (i)
    59                                  
    60                                  display_loop:
    61 00000019 4D39EE                      cmp r14, r13                ; i < count
    62 0000001C 7D54                        jge end_display_loop
    63                                  
    64                                      ; 1. Convert float to string
    65 0000001E F2430F1004F4                movsd xmm0, [r12 + r14 * 8] ; Load float
    66                                      
    67                                      ; Save loop registers (r12, r13, r14)
    68                                      ; ftoa clobbers them
    69 00000024 4154                        push r12
    70 00000026 4155                        push r13
    71 00000028 4156                        push r14
    72                                      
    73 0000002A E8(00000000)                call ftoa
    74                                      
    75 0000002F 4889C3                      mov rbx, rax ; rax holds pointer to string from ftoa
    76                                      
    77                                      ; Restore loop registers
    78 00000032 415E                        pop r14
    79 00000034 415D                        pop r13
    80 00000036 415C                        pop r12
    81                                  
    82                                      ; 2. Get length of string
    83 00000038 4889DF                      mov rdi, rbx                ; rdi = string pointer
    84 0000003B E83D000000                  call display_strlen         ; <<< RENAMED
    85 00000040 4889C2                      mov rdx, rax                ; Length for sys_write
    86                                  
    87                                      ; 3. Print float string
    88 00000043 B801000000                  mov rax, 1
    89 00000048 BF01000000                  mov rdi, 1
    90 0000004D 4889DE                      mov rsi, rbx                ; rsi = string pointer
    91 00000050 0F05                        syscall
    92                                  
    93                                      ; 4. Print newline
    94 00000052 B801000000                  mov rax, 1
    95 00000057 BF01000000                  mov rdi, 1
    96 0000005C 48BE-                       mov rsi, newline
    96 0000005E [0000000000000000] 
    97 00000066 BA01000000                  mov rdx, 1
    98 0000006B 0F05                        syscall
    99                                  
   100 0000006D 49FFC6                      inc r14
   101 00000070 EBA7                        jmp display_loop
   102                                  
   103                                  end_display_loop:
   104                                      ; Epilogue
   105 00000072 5B                          pop rbx
   106 00000073 415F                        pop r15                ; 
   107 00000075 415E                        pop r14
   108 00000077 415D                        pop r13
   109 00000079 415C                        pop r12
   110 0000007B 5D                          pop rbp
   111 0000007C C3                          ret
   112                                  
   113                                  ; Local strlen function
   114                                  ; Input: rdi (string pointer)
   115                                  ; Output: rax (length)
   116                                  display_strlen:             ; 
   117 0000007D 57                          push rdi
   118 0000007E 53                          push rbx
   119 0000007F 4889FB                      mov rbx, rdi
   120 00000082 B800000000                  mov rax, 0
   121                                  display_strlen_loop:        ;
   122 00000087 803C0300                    cmp byte [rbx + rax], 0
   123 0000008B 7405                        je display_strlen_end
   124 0000008D 48FFC0                      inc rax
   125 00000090 EBF5                        jmp display_strlen_loop
   126                                  display_strlen_end:         ; 
   127 00000092 5B                          pop rbx
   128 00000093 5F                          pop rdi
   129 00000094 C3                          ret
