     1                                  ;****************************************************************************************************************************
     2                                  ;Program name: "arithmetic". This program is the main supervisor module. It controls the overall flow of the
     3                                  ;              application, including getting user input, calling other modules to process data, and exiting.
     4                                  ;
     5                                  ;This file is part of the software program "Sum of Values".
     6                                  ;****************************************************************************************************************************
     7                                  ;=======1=========2=========3=========4=========5=========6=========7=========8=========9=========0=========1=========2=========3**//
     8                                  ;
     9                                  ;Author information
    10                                  ;  Author name: konner rigby
    11                                  ;  Author email: rigbykonner@csu.fullerton.edu
    12                                  ;  CWID: 884547654
    13                                  ;  Class: 240-03 Section 03
    14                                  ;
    15                                  ;Program information
    16                                  ;  Program name: Sum of Values
    17                                  ;  Programming languages: X86 Assembly (NASM)
    18                                  ;  Files in this program: arithmetic.asm, adder.asm, get_numbers.asm, display_array.asm,
    19                                  ;                         ftoa.asm, getline.asm, getchar.asm, atof.asm, isfloat.asm
    20                                  ;
    21                                  ;Purpose
    22                                  ;  The purpose of this file is to serve as the entry point and main controller for the application.
    23                                  ;  It manages I/O for the user's name, prompts for numbers, and coordinates calls to other
    24                                  ;  modules to get numbers, display the array, sum the array, and display the result.
    25                                  ;
    26                                  ;This file
    27                                  ;   File name: arithmetic.asm
    28                                  ;   Language: x86 (NASM syntax)
    29                                  ;   Compile: nasm -f elf64 -o arithmetic.o -l arithmetic.lis arithmetic.asm
    30                                  ;****************************************************************************************************************************
    31                                  
    32                                  global _start
    33                                  
    34                                  extern getline
    35                                  extern get_numbers
    36                                  extern display_array
    37                                  extern adder
    38                                  extern ftoa
    39                                  
    40                                  segment .data
    41 00000000 57656C636F6D652E20-         welcome_msg: db "Welcome. Please enter your full name: ", 0
    41 00000009 506C6561736520656E-
    41 00000012 74657220796F757220-
    41 0000001B 66756C6C206E616D65-
    41 00000024 3A2000             
    42                                      welcome_len: equ $ - welcome_msg
    43                                  
    44 00000027 506C6561736520656E-         prompt_floats: db "Please enter some float numbers each one separated by a press of the enter key. Terminate by pressing Ctrl+D on an empty line.", 0x0A, 0
    44 00000030 74657220736F6D6520-
    44 00000039 666C6F6174206E756D-
    44 00000042 626572732065616368-
    44 0000004B 206F6E652073657061-
    44 00000054 726174656420627920-
    44 0000005D 61207072657373206F-
    44 00000066 662074686520656E74-
    44 0000006F 6572206B65792E2054-
    44 00000078 65726D696E61746520-
    44 00000081 627920707265737369-
    44 0000008A 6E67204374726C2B44-
    44 00000093 206F6E20616E20656D-
    44 0000009C 707479206C696E652E-
    44 000000A5 0A00               
    45                                      prompt_floats_len: equ $ - prompt_floats
    46                                  
    47 000000A7 0A5468616E6B20796F-         thanks_msg: db 0x0A, "Thank you. You entered:", 0x0A, 0
    47 000000B0 752E20596F7520656E-
    47 000000B9 74657265643A0A00   
    48                                      thanks_len: equ $ - thanks_msg
    49                                  
    50 000000C1 0A5468652073756D20-         sum_msg: db 0x0A, "The sum is ", 0
    50 000000CA 69732000           
    51                                      sum_len: equ $ - sum_msg
    52                                  
    53 000000CE 0A486176652061206E-         goodbye_msg: db 0x0A, "Have a nice day, ", 0
    53 000000D7 696365206461792C20-
    53 000000E0 00                 
    54                                      goodbye_len: equ $ - goodbye_msg
    55                                  
    56 000000E1 0A00                        newline: db 0x0A, 0
    57                                      newline_len: equ 1
    58                                  
    59                                  segment .bss
    60 00000000 <res 64h>                   user_name: resb 100         ; buffer for user's name
    61 00000064 <res 320h>                  float_array: resb 800       ; buffer for up to 100 floats (8 bytes each)
    62 00000384 <res 64h>                   float_buffer: resb 100      ; buffer for float-to-string conversion
    63                                  
    64                                  segment .text
    65                                  _start:
    66                                      ; setup stack frame
    67 00000000 55                          push rbp
    68 00000001 4889E5                      mov rbp, rsp
    69                                  
    70                                      ; print welcome message
    71 00000004 B801000000                  mov rax, 1
    72 00000009 BF01000000                  mov rdi, 1
    73 0000000E 48BE-                       mov rsi, welcome_msg
    73 00000010 [0000000000000000] 
    74 00000018 BA27000000                  mov rdx, welcome_len
    75 0000001D 0F05                        syscall
    76                                  
    77                                      ; get user name
    78 0000001F 48BF-                       mov rdi, user_name
    78 00000021 [0000000000000000] 
    79 00000029 BE64000000                  mov rsi, 100
    80 0000002E E8(00000000)                call getline
    81 00000033 4989C6                      mov r14, rax                ; save name length
    82                                  
    83                                      ; remove newline from name
    84 00000036 4180BE[FFFFFFFF]0A          cmp byte [user_name + r14 - 1], 0x0A
    85 0000003E 750B                        jne name_newline_done
    86 00000040 41C686[FFFFFFFF]00          mov byte [user_name + r14 - 1], 0
    87 00000048 49FFCE                      dec r14
    88                                  name_newline_done:
    89                                  
    90                                      ; prompt for floats
    91 0000004B B801000000                  mov rax, 1
    92 00000050 BF01000000                  mov rdi, 1
    93 00000055 48BE-                       mov rsi, prompt_floats
    93 00000057 [2700000000000000] 
    94 0000005F BA80000000                  mov rdx, prompt_floats_len
    95 00000064 0F05                        syscall
    96                                  
    97                                      ; read float numbers
    98 00000066 48BF-                       mov rdi, float_array
    98 00000068 [6400000000000000] 
    99 00000070 BE64000000                  mov rsi, 100
   100 00000075 E8(00000000)                call get_numbers
   101 0000007A 4989C7                      mov r15, rax                ; number of floats entered
   102                                  
   103                                      ; print thank you message
   104 0000007D B801000000                  mov rax, 1
   105 00000082 BF01000000                  mov rdi, 1
   106 00000087 48BE-                       mov rsi, thanks_msg
   106 00000089 [A700000000000000] 
   107 00000091 BA1A000000                  mov rdx, thanks_len
   108 00000096 0F05                        syscall
   109                                  
   110                                      ; display the array
   111 00000098 48BF-                       mov rdi, float_array
   111 0000009A [6400000000000000] 
   112 000000A2 4C89FE                      mov rsi, r15
   113 000000A5 E8(00000000)                call display_array
   114                                  
   115                                      ; calculate the sum
   116 000000AA 48BF-                       mov rdi, float_array
   116 000000AC [6400000000000000] 
   117 000000B4 4C89FE                      mov rsi, r15
   118 000000B7 E8(00000000)                call adder
   119 000000BC F20F10C8                    movsd xmm1, xmm0            ; store sum
   120                                  
   121                                      ; print "The sum is "
   122 000000C0 B801000000                  mov rax, 1
   123 000000C5 BF01000000                  mov rdi, 1
   124 000000CA 48BE-                       mov rsi, sum_msg
   124 000000CC [C100000000000000] 
   125 000000D4 BA0D000000                  mov rdx, sum_len
   126 000000D9 0F05                        syscall
   127                                  
   128                                      ; convert sum to string and print it
   129 000000DB F20F10C1                    movsd xmm0, xmm1
   130 000000DF E8(00000000)                call ftoa                   ; returns pointer to string in rax
   131 000000E4 4989C4                      mov r12, rax
   132                                  
   133                                      ; get length of string
   134 000000E7 4C89E7                      mov rdi, r12
   135 000000EA E86B000000                  call strlen_local
   136 000000EF 4889C2                      mov rdx, rax
   137                                  
   138                                      ; print the sum string
   139 000000F2 B801000000                  mov rax, 1
   140 000000F7 BF01000000                  mov rdi, 1
   141 000000FC 4C89E6                      mov rsi, r12
   142 000000FF 0F05                        syscall
   143                                  
   144                                      ; print goodbye message
   145 00000101 B801000000                  mov rax, 1
   146 00000106 BF01000000                  mov rdi, 1
   147 0000010B 48BE-                       mov rsi, goodbye_msg
   147 0000010D [CE00000000000000] 
   148 00000115 BA13000000                  mov rdx, goodbye_len
   149 0000011A 0F05                        syscall
   150                                  
   151                                      ; print user's name
   152 0000011C B801000000                  mov rax, 1
   153 00000121 BF01000000                  mov rdi, 1
   154 00000126 48BE-                       mov rsi, user_name
   154 00000128 [0000000000000000] 
   155 00000130 4C89F2                      mov rdx, r14
   156 00000133 0F05                        syscall
   157                                  
   158                                      ; print final newline
   159 00000135 B801000000                  mov rax, 1
   160 0000013A BF01000000                  mov rdi, 1
   161 0000013F 48BE-                       mov rsi, newline
   161 00000141 [E100000000000000] 
   162 00000149 BA01000000                  mov rdx, newline_len
   163 0000014E 0F05                        syscall
   164                                  
   165                                      ; exit program
   166 00000150 B83C000000                  mov rax, 60
   167 00000155 4831FF                      xor rdi, rdi
   168 00000158 0F05                        syscall
   169                                  
   170                                  ; strlen_local: returns length of a null-terminated string
   171                                  ; input:  rdi = pointer to string
   172                                  ; output: rax = string length
   173                                  strlen_local:
   174 0000015A 57                          push rdi
   175 0000015B B800000000                  mov rax, 0
   176                                  strlen_loop:
   177 00000160 803C0700                    cmp byte [rdi + rax], 0
   178 00000164 7405                        je strlen_end
   179 00000166 48FFC0                      inc rax
   180 00000169 EBF5                        jmp strlen_loop
   181                                  strlen_end:
   182 0000016B 5F                          pop rdi
   183 0000016C C3                          ret
