     1                                  ;****************************************************************************************************************************
     2                                  ;* Program name: Non-deterministic Random Numbers                                                                           *
     3                                  ;* Copyright (C) 2025 Konner Rigby.                                                                                           *
     4                                  ;* This file is part of the Non-deterministic Random Numbers program.                                                       *
     5                                  ;****************************************************************************************************************************
     6                                  ;========1=========2=========3=========4=========5=========6=========7=========8=========9=========0=========1=========2=========3**
     7                                  ; Author information
     8                                  ; Author: Konner Rigby
     9                                  ; Author Email: rigbykonner@csu.fullerton.edu or rigbykonner@gmail.com
    10                                  ; CWID: 884547654
    11                                  ; Class: 240-03 Section 03
    12                                  ;
    13                                  ; This file
    14                                  ;   File name: normalize_array.asm
    15                                  ;   Function: normalize_array
    16                                  ;   Purpose: Normalizes an array of 64-bit doubles to the
    17                                  ;            range [1.0, 2.0) using bitwise manipulation.
    18                                  ;   Language: x86-64 Assembly
    19                                  ;   Syntax: Intel
    20                                  ;   Assembler: nasm -f elf64 -g -o normalize_array.o normalize_array.asm
    21                                  ;========1=========2=========3=========4=========5=========6=========7=========8=========9=========0=========1=========2=========3**
    22                                  
    23                                  ; === Declarations ===
    24                                  global normalize_array
    25                                  
    26                                  ; === Initialized Data ===
    27                                  segment .data
    28                                      ; Mask to extract the 52-bit mantissa
    29 00000000 FFFFFFFFFFFF0F00            mantissa_mask:  dq 0x000FFFFFFFFFFFFF
    30                                      ; The new sign (0) and exponent (0x3FF) to apply
    31 00000008 000000000000F03F            new_exponent:   dq 0x3FF0000000000000
    32                                  segment .bss
    33                                      ; This section is empty.
    34                                  
    35                                  ; === Code ===
    36                                  segment .text
    37                                  normalize_array:
    38                                      ; === Standard Prologue ===
    39 00000000 55                          push    rbp
    40 00000001 4889E5                      mov     rbp, rsp
    41 00000004 4154                        push    r12             ; Callee-saved register for array base
    42 00000006 4155                        push    r13             ; Callee-saved register for count
    43 00000008 4156                        push    r14             ; Callee-saved register for loop counter
    44                                  
    45                                      ; === Save passed-in values ===
    46 0000000A 4989FC                      mov     r12, rdi        ; r12 = array address
    47 0000000D 4989F5                      mov     r13, rsi        ; r13 = count
    48 00000010 4D31F6                      xor     r14, r14        ; r14 = loop counter i = 0
    49                                  
    50                                  normalize_loop:
    51                                      ; === Begin main loop to normalize array ===
    52 00000013 4D39EE                      cmp     r14, r13        ; Compare i with count
    53 00000016 7D23                        jge     normalize_done  ; (using signed jump)
    54                                      
    55                                      ; Load the current random number's integer representation
    56 00000018 4B8B04F4                    mov     rax, [r12 + r14 * 8]
    57                                      
    58                                      ; === Isolate original mantissa ===
    59 0000001C 488B0C25[00000000]          mov     rcx, [mantissa_mask]
    60 00000024 4821C8                      and     rax, rcx        ; RAX now holds only the mantissa
    61                                      
    62                                      ; === Combine mantissa with new exponent [1.0, 2.0) ===
    63 00000027 488B0C25[08000000]          mov     rcx, [new_exponent]
    64 0000002F 4809C8                      or      rax, rcx        ; RAX is now 0x3FF... | original_mantissa
    65                                      
    66                                      ; === Store normalized number back into array ===
    67 00000032 4B8904F4                    mov     [r12 + r14 * 8], rax
    68                                      
    69 00000036 49FFC6                      inc     r14             ; i++
    70 00000039 EBD8                        jmp     normalize_loop
    71                                  
    72                                  normalize_done:
    73                                      ; === Standard Epilogue ===
    74 0000003B 415E                        pop     r14
    75 0000003D 415D                        pop     r13
    76 0000003F 415C                        pop     r12
    77 00000041 5D                          pop     rbp
    78 00000042 C3                          ret
