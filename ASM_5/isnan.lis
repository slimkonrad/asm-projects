     1                                  ;****************************************************************************************************************************
     2                                  ;* Program name: Non-deterministic Random Numbers                                                                           *
     3                                  ;* Copyright (C) 2025 Konner Rigby.                                                                                           *
     4                                  ;* This file is part of the Non-deterministic Random Numbers program.                                                       *
     5                                  ;****************************************************************************************************************************
     6                                  ;========1=========2=========3=========4=========5=========6=========7=========8=========9=========0=========1=========2=========3**
     7                                  ; Author information
     8                                  ; Author: Konner Rigby
     9                                  ; Author Email: rigbykonner@csu.fullerton.edu or rigbykonner@gmail.com
    10                                  ; CWID: 884547654
    11                                  ; Class: 240-03 Section 03
    12                                  ;
    13                                  ; This file
    14                                  ;   File name: isnan.asm
    15                                  ;   Function: isnan
    16                                  ;   Purpose: This function will determine if an IEEE float number is a nan
    17                                  ;            by checking the exponent bits.
    18                                  ;   Language: x86-64 Assembly
    19                                  ;   Syntax: Intel
    20                                  ;   Assembler: nasm -f elf64 -g -o isnan.o isnan.asm
    21                                  ;   Source: CPSC 240 Website (Public Domain, F. Holliday)
    22                                  ;========1=========2=========3=========4=========5=========6=========7=========8=========9=========0=========1=========2=========3**
    23                                  
    24                                  global isnan
    25                                  
    26                                  segment .data
    27                                      ;Empty
    28                                  segment .bss
    29                                      ;Empty
    30                                  segment .text
    31                                  isnan:
    32                                      ; === Standard Prologue ===
    33                                      ; Back up the GPRs (General Purpose Registers)
    34 00000000 55                          push rbp
    35 00000001 4889E5                      mov rbp, rsp
    36 00000004 53                          push rbx
    37 00000005 51                          push rcx
    38 00000006 52                          push rdx
    39 00000007 57                          push rdi
    40 00000008 56                          push rsi
    41 00000009 4150                        push r8
    42 0000000B 4151                        push r9
    43 0000000D 4152                        push r10
    44 0000000F 4153                        push r11
    45 00000011 4154                        push r12
    46 00000013 4155                        push r13
    47 00000015 4156                        push r14
    48 00000017 4157                        push r15
    49 00000019 9C                          pushf
    50                                  
    51                                      ; === Copy the incoming parameter to a GPR ===
    52                                      ; We need a temporary 8-byte slot on the stack.
    53                                      ; This is a very clever way to move xmm0 -> r8.
    54 0000001A 6A00                        push qword 0
    55 0000001C F20F110424                  movsd [rsp], xmm0
    56 00000021 4158                        pop r8
    57                                  
    58                                      ; === Use shift instructions to isolate the stored exponent ===
    59 00000023 49D1E0                      shl r8, 1           ; Shift left 1 (removes sign bit)
    60 00000026 49C1E835                    shr r8, 53          ; Shift right 53 (isolates 11 exponent bits)
    61                                  
    62                                      ; === Is r8 equal to 2047 (0x7FF) or not? ===
    63 0000002A 4981F8FF070000              cmp r8, 2047
    64 00000031 7407                        je  it_is_a_nan
    65 00000033 B800000000                  mov rax, 0          ; 0 = false (not a NaN)
    66 00000038 EB05                        jmp next
    67                                  it_is_a_nan:
    68 0000003A B801000000                  mov rax, 1          ; 1 = true (is a NaN or Infinity)
    69                                  next:
    70                                  
    71                                      ; The result (0 or 1) is now in rax
    72                                  
    73                                      ; === Standard Epilogue ===
    74 0000003F 9D                          popf
    75 00000040 415F                        pop r15
    76 00000042 415E                        pop r14
    77 00000044 415D                        pop r13
    78 00000046 415C                        pop r12
    79 00000048 415B                        pop r11
    80 0000004A 415A                        pop r10
    81 0000004C 4159                        pop r9
    82 0000004E 4158                        pop r8
    83 00000050 5E                          pop rsi
    84 00000051 5F                          pop rdi
    85 00000052 5A                          pop rdx
    86 00000053 59                          pop rcx
    87 00000054 5B                          pop rbx
    88 00000055 5D                          pop rbp
    89 00000056 C3                          ret
