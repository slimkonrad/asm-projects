     1                                  ; //****************************************************************************************************************************
     2                                  ; //Program name: "arithmetic". This program is the main supervisor module. It controls the overall flow of the
     3                                  ; //              application, including getting user input, calling other modules to process data, and exiting.
     4                                  ; //
     5                                  ; //This file is part of the software program "Sum of Values".
     6                                  ; //****************************************************************************************************************************
     7                                  ; //=======1=========2=========3=========4=========5=========6=========7=========8=========9=========0=========1=========2=========3**//
     8                                  ;
     9                                  ; //Author information
    10                                  ; //  Author name: konner rigby
    11                                  ; //  Author email: rigbykonner@csu.fullerton.edu
    12                                  ; //  CWID: 884547654
    13                                  ; //  Class: 240-03 Section 03
    14                                  ; //
    15                                  ; //Program information
    16                                  ; //  Program name: Sum of Values
    17                                  ; //  Programming languages: X86 Assembly (NASM)
    18                                  ; //  Files in this program: arithmetic.asm, adder.asm, get_numbers.asm, display_array.asm,
    19                                  ; //                         ftoa.asm, getline.asm, getchar.asm, atof.asm, isfloat.asm
    20                                  ; //
    21                                  ; //Purpose
    22                                  ; //  The purpose of this file is to serve as the entry point and main controller for the application.
    23                                  ; //  It manages I/O for the user's name, prompts for numbers, and coordinates calls to other
    24                                  ; //  modules to get numbers, display the array, sum the array, and display the result.
    25                                  ; //
    26                                  ; //This file
    27                                  ; //   File name: arithmetic.asm
    28                                  ; //   Language: x86 (NASM syntax)
    29                                  ; //   Compile: nasm -f elf64 -o arithmetic.o -l arithmetic.lis arithmetic.asm
    30                                  ; //
    31                                  ; //=======1=========2=========3=========4=========5=========6=========7=========8=========9=========0=========1=========2=========3**
    32                                  ; //
    33                                  ; //
    34                                  ; //===== Begin code area ===========================================================================================================
    35                                  
    36                                  global _start
    37                                  
    38                                  extern getline
    39                                  extern get_numbers
    40                                  extern display_array
    41                                  extern adder
    42                                  extern ftoa
    43                                  
    44                                  segment .data
    45 00000000 57656C636F6D652E20-         welcome_msg: db "Welcome. Please enter your full name: ", 0
    45 00000009 506C6561736520656E-
    45 00000012 74657220796F757220-
    45 0000001B 66756C6C206E616D65-
    45 00000024 3A2000             
    46                                      welcome_len: equ $ - welcome_msg
    47                                  
    48                                      ; --- THIS PROMPT MENTIONS Ctrl+D ---
    49 00000027 506C6561736520656E-         prompt_floats: db "Please enter some float numbers each one separated by a press of the enter key. Terminate by pressing Ctrl+D on an empty line.", 0x0A, 0
    49 00000030 74657220736F6D6520-
    49 00000039 666C6F6174206E756D-
    49 00000042 626572732065616368-
    49 0000004B 206F6E652073657061-
    49 00000054 726174656420627920-
    49 0000005D 61207072657373206F-
    49 00000066 662074686520656E74-
    49 0000006F 6572206B65792E2054-
    49 00000078 65726D696E61746520-
    49 00000081 627920707265737369-
    49 0000008A 6E67204374726C2B44-
    49 00000093 206F6E20616E20656D-
    49 0000009C 707479206C696E652E-
    49 000000A5 0A00               
    50                                      prompt_floats_len: equ $ - prompt_floats
    51                                  
    52 000000A7 0A5468616E6B20796F-         thanks_msg: db 0x0A, "Thank you. You entered:", 0x0A, 0
    52 000000B0 752E20596F7520656E-
    52 000000B9 74657265643A0A00   
    53                                      thanks_len: equ $ - thanks_msg
    54                                  
    55 000000C1 0A5468652073756D20-         sum_msg: db 0x0A, "The sum is ", 0
    55 000000CA 69732000           
    56                                      sum_len: equ $ - sum_msg
    57                                  
    58 000000CE 0A486176652061206E-         goodbye_msg: db 0x0A, "Have a nice day, ", 0
    58 000000D7 696365206461792C20-
    58 000000E0 00                 
    59                                      goodbye_len: equ $ - goodbye_msg
    60                                  
    61 000000E1 0A00                        newline: db 0x0A, 0
    62                                      newline_len: equ 1
    63                                  
    64                                  segment .bss
    65 00000000 <res 64h>                   user_name: resb 100         ; Buffer for user's name
    66 00000064 <res 320h>                  float_array: resb 800       ; Array for floats (100 floats * 8 bytes)
    67 00000384 <res 64h>                   float_buffer: resb 100      ; Buffer for float-to-string conversion
    68                                  
    69                                  segment .text
    70                                  _start:
    71                                      ; Prologue
    72 00000000 55                          push rbp
    73 00000001 4889E5                      mov rbp, rsp
    74                                  
    75                                      ; 1. Welcome and get name
    76 00000004 B801000000                  mov rax, 1                  ; sys_write
    77 00000009 BF01000000                  mov rdi, 1                  ; stdout
    78 0000000E 48BE-                       mov rsi, welcome_msg
    78 00000010 [0000000000000000] 
    79 00000018 BA27000000                  mov rdx, welcome_len
    80 0000001D 0F05                        syscall
    81                                  
    82 0000001F 48BF-                       mov rdi, user_name          ; Buffer
    82 00000021 [0000000000000000] 
    83 00000029 BE64000000                  mov rsi, 100                ; Max length
    84 0000002E E8(00000000)                call getline
    85 00000033 4989C6                      mov r14, rax                ; Save length of name
    86                                  
    87                                      ; Stomp newline from name
    88 00000036 4180BE[FFFFFFFF]0A          cmp byte [user_name + r14 - 1], 0x0A
    89 0000003E 750B                        jne name_newline_done
    90 00000040 41C686[FFFFFFFF]00          mov byte [user_name + r14 - 1], 0
    91 00000048 49FFCE                      dec r14                     ; Decrement length
    92                                      name_newline_done:
    93                                  
    94                                      ; 2. Prompt for numbers
    95 0000004B B801000000                  mov rax, 1
    96 00000050 BF01000000                  mov rdi, 1
    97 00000055 48BE-                       mov rsi, prompt_floats
    97 00000057 [2700000000000000] 
    98 0000005F BA80000000                  mov rdx, prompt_floats_len
    99 00000064 0F05                        syscall
   100                                  
   101                                      ; 3. Get numbers
   102 00000066 48BF-                       mov rdi, float_array
   102 00000068 [6400000000000000] 
   103 00000070 BE64000000                  mov rsi, 100                ; Max 100 floats
   104 00000075 E8(00000000)                call get_numbers
   105 0000007A 4989C7                      mov r15, rax                ; Save number of floats in r15
   106                                  
   107                                      ; 4. "Thank you. You entered:"
   108 0000007D B801000000                  mov rax, 1
   109 00000082 BF01000000                  mov rdi, 1
   110 00000087 48BE-                       mov rsi, thanks_msg
   110 00000089 [A700000000000000] 
   111 00000091 BA1A000000                  mov rdx, thanks_len
   112 00000096 0F05                        syscall
   113                                  
   114                                      ; 5. Display array
   115 00000098 48BF-                       mov rdi, float_array
   115 0000009A [6400000000000000] 
   116 000000A2 4C89FE                      mov rsi, r15                ; Count
   117 000000A5 E8(00000000)                call display_array
   118                                  
   119                                      ; 6. Call adder
   120 000000AA 48BF-                       mov rdi, float_array
   120 000000AC [6400000000000000] 
   121 000000B4 4C89FE                      mov rsi, r15                ; Count
   122 000000B7 E8(00000000)                call adder
   123 000000BC F20F10C8                    movsd xmm1, xmm0            ; Save sum in xmm1
   124                                  
   125                                      ; 7. Print "The sum is "
   126 000000C0 B801000000                  mov rax, 1
   127 000000C5 BF01000000                  mov rdi, 1
   128 000000CA 48BE-                       mov rsi, sum_msg
   128 000000CC [C100000000000000] 
   129 000000D4 BA0D000000                  mov rdx, sum_len
   130 000000D9 0F05                        syscall
   131                                  
   132                                      ; 8. Convert sum to string and print
   133 000000DB F20F10C1                movsd xmm0, xmm1            ; sum -> xmm0 (argument to ftoa)
   134 000000DF E8(00000000)            call ftoa                   ; RAX = pointer to ftoa's internal buffer
   135                                  
   136 000000E4 4989C4                  mov r12, rax                ; save the returned pointer
   137                                  
   138                                  ; compute length
   139 000000E7 4C89E7                  mov rdi, r12                ; strlen_local(arg = pointer)
   140 000000EA E86B000000              call strlen_local           ; RAX = length
   141 000000EF 4889C2                  mov rdx, rax                ; rdx = length for write
   142                                  
   143                                  ; write the string
   144 000000F2 B801000000              mov rax, 1                  ; sys_write
   145 000000F7 BF01000000              mov rdi, 1                  ; fd = stdout
   146 000000FC 4C89E6                  mov rsi, r12                ; buf = pointer returned by ftoa
   147 000000FF 0F05                    syscall
   148                                  
   149                                      ; 9. "Have a nice day, [name]"
   150 00000101 B801000000                  mov rax, 1
   151 00000106 BF01000000                  mov rdi, 1
   152 0000010B 48BE-                       mov rsi, goodbye_msg
   152 0000010D [CE00000000000000] 
   153 00000115 BA13000000                  mov rdx, goodbye_len
   154 0000011A 0F05                        syscall
   155                                  
   156 0000011C B801000000                  mov rax, 1
   157 00000121 BF01000000                  mov rdi, 1
   158 00000126 48BE-                       mov rsi, user_name
   158 00000128 [0000000000000000] 
   159 00000130 4C89F2                      mov rdx, r14                ; Use saved name length
   160 00000133 0F05                        syscall
   161                                  
   162                                      ; 10. Print final newline
   163 00000135 B801000000                  mov rax, 1
   164 0000013A BF01000000                  mov rdi, 1
   165 0000013F 48BE-                       mov rsi, newline
   165 00000141 [E100000000000000] 
   166 00000149 BA01000000                  mov rdx, newline_len
   167 0000014E 0F05                        syscall
   168                                  
   169                                      ; 11. Exit
   170 00000150 B83C000000                  mov rax, 60
   171 00000155 4831FF                      xor rdi, rdi
   172 00000158 0F05                        syscall
   173                                  
   174                                  ; Local strlen function
   175                                  ; Input: rdi (string pointer)
   176                                  ; Output: rax (length)
   177                                  strlen_local:
   178 0000015A 57                          push rdi
   179 0000015B B800000000                  mov rax, 0
   180                                  strlen_loop:
   181 00000160 803C0700                    cmp byte [rdi + rax], 0
   182 00000164 7405                        je strlen_end
   183 00000166 48FFC0                      inc rax
   184 00000169 EBF5                        jmp strlen_loop
   185                                  strlen_end:
   186 0000016B 5F                          pop rdi
   187 0000016C C3                          ret
