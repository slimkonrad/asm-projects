     1                                  ;****************************************************************************************************************************
     2                                  ;* Program name: "Array of floats".  This program takes floating point number inputs from the user and puts them in an array. The array values are then printed, along with the variance of the numbers.
     3                                  ;* Copyright (C) 2025  Konner Rigby.                                                                                         *
     4                                  ;* *
     5                                  ;* This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License  *
     6                                  ;* version 3 as published by the Free Software Foundation.  This program is distributed in the hope that it will be useful,  *
     7                                  ;* but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See  *
     8                                  ;* the GNU General public license for more details A copy of the GNU General Public License v3 is available here:           *
     9                                  ;* <https://www.gnu.org/licenses/>.                                                                                           *
    10                                  ;****************************************************************************************************************************
    11                                  
    12                                  ;========1=========2=========3=========4=========5=========6=========7=========8=========9=========0=========1=========2=========3**
    13                                  ; Author information
    14                                  ; Author: Konner Rigby
    15                                  ; Author Email: rigbykonner@csu.fullerton.edu or rigbykonner@gmail.com
    16                                  ; CWID: 884547654
    17                                  ; Class: 204-03 Section 03
    18                                  ;
    19                                  ;Program information
    20                                  ;  Program name: Array of floats
    21                                  ;  Programming languages: Two modules in C, six in x86, and one in bash
    22                                  ;  Date program began: 2025-Sep-16
    23                                  ;  Date of last update: 2025-Sep-19
    24                                  ;  Files in this program: main.cpp, manager.asm, input_array.asm, mean.asm, isfloat.asm,
    25                                  ;  display_array.c, magnitude.asm, append.asm, r.sh.
    26                                  ;  Testing: Alpha testing completed.  All functions are correct.
    27                                  ;  Status: Ready for release to customers
    28                                  ;
    29                                  ;Purpose
    30                                  ;  This program takes floating point number inputs from the user and puts them in an array. The array
    31                                  ;  values are then printed, along with the variance of the numbers.
    32                                  ;
    33                                  ;This file:
    34                                  ;  File name: input_array.asm
    35                                  ;  Language: X86-64
    36                                  ;  Max page width: 124 columns
    37                                  ;  Assemble (standard): nasm -f elf64 -l input.lis -o input.o input_array.asm
    38                                  ;  Assemble (debug): nasm -f elf64 -gdwarf -l input.lis -o input.o input_array.asm
    39                                  ;  Optimal print specification: Landscape, 7 points, monospace, 8Â½x11 paper
    40                                  ;  Prototype of this function: extern double input_array();
    41                                  ;
    42                                  ;========1=========2=========3=========4=========5=========6=========7=========8=========9=========0=========1=========2=========3**
    43                                  ; input_array.asm
    44                                  global input_array
    45                                  %include "backuprestore.inc"
    46                              <1> ; Author: Konner Rigby
    47                              <1> ; Author Email: rigbykonner@csu.fullerton.edu or rigbykonner@gmail.com
    48                              <1> ; CWID: 884547654
    49                              <1> ; Class: 240-03 Section 03
    50                              <1> ; Purpose: macroes to backup and restore registers.
    51                              <1> 
    52                              <1> %macro backup 0
    53                              <1>     push rbp
    54                              <1>     mov rbp, rsp
    55                              <1>     push rbx
    56                              <1>     push rcx
    57                              <1>     push rdx
    58                              <1>     push rdi
    59                              <1>     push rsi
    60                              <1>     push r8
    61                              <1>     push r9
    62                              <1>     push r10
    63                              <1>     push r11
    64                              <1>     push r12
    65                              <1>     push r13
    66                              <1>     push r14
    67                              <1>     push r15
    68                              <1>     pushf
    69                              <1>                                       ;Backup rflags
    70                              <1> %endmacro
    71                              <1> 
    72                              <1> %macro restore 0
    73                              <1>     popf
    74                              <1>     pop r15
    75                              <1>     pop r14
    76                              <1>     pop r13
    77                              <1>     pop r12
    78                              <1>     pop r11
    79                              <1>     pop r10
    80                              <1>     pop r9
    81                              <1>     pop r8
    82                              <1>     pop rsi
    83                              <1>     pop rdi
    84                              <1>     pop rdx
    85                              <1>     pop rcx
    86                              <1>     pop rbx
    87                              <1>     pop rbp   ;Restore rbp to the base of the activation record of the caller program                 ;Restore rbp
    88                              <1> %endmacro
    46                                  
    47                                  extern printf
    48                                  extern scanf
    49                                  extern atof
    50                                  extern isfloat
    51                                  extern clearerr, stdin
    52                                  
    53                                  segment .data
    54 00000000 257300                    floatformat   db  "%s", 0
    55 00000003 546865206C61737420-       not_a_float   db  "The last input was invalid and not entered into the array", 10, 0
    55 0000000C 696E70757420776173-
    55 00000015 20696E76616C696420-
    55 0000001E 616E64206E6F742065-
    55 00000027 6E746572656420696E-
    55 00000030 746F20746865206172-
    55 00000039 7261790A00         
    56 0000003E 546865206172726179-       full_message  db  "The array has been filled.", 10, 0
    56 00000047 20686173206265656E-
    56 00000050 2066696C6C65642E0A-
    56 00000059 00                 
    57                                  
    58                                  segment .bss
    59 00000000 <res 320h>                buffer resb 800
    60                                  
    61                                  segment .text
    62                                  input_array:
    63                                  
    64                                  ; --- Standard Prologue ---
    65                                  backup
    53 00000000 55                  <1>  push rbp
    54 00000001 4889E5              <1>  mov rbp, rsp
    55 00000004 53                  <1>  push rbx
    56 00000005 51                  <1>  push rcx
    57 00000006 52                  <1>  push rdx
    58 00000007 57                  <1>  push rdi
    59 00000008 56                  <1>  push rsi
    60 00000009 4150                <1>  push r8
    61 0000000B 4151                <1>  push r9
    62 0000000D 4152                <1>  push r10
    63 0000000F 4153                <1>  push r11
    64 00000011 4154                <1>  push r12
    65 00000013 4155                <1>  push r13
    66 00000015 4156                <1>  push r14
    67 00000017 4157                <1>  push r15
    68 00000019 9C                  <1>  pushf
    69                              <1> 
    66                                  
    67                                  ; --- Save Arguments and Initialize Counters ---
    68 0000001A 4989FF                  mov r15, rdi      ; r15 = array address (1st argument)
    69 0000001D 4989F6                  mov r14, rsi      ; r14 = max size (2nd argument)
    70 00000020 4D31ED                  xor r13, r13      ; r13 = loop counter, initialized to 0
    71                                  
    72                                  check_capacity:
    73                                      ; Compare the counter to the max array size
    74 00000023 4D39F5                      cmp r13, r14
    75 00000026 7D58                        jge is_full       ; If full, jump to the end message
    76                                  
    77                                      ; Prepare for scanf
    78 00000028 48BF-                       mov rdi, floatformat
    78 0000002A [0000000000000000] 
    79 00000032 48BE-                       mov rsi, buffer
    79 00000034 [0000000000000000] 
    80 0000003C 4831C0                      xor rax, rax
    81 0000003F E8(00000000)                call scanf
    82                                  
    83                                      ; Check for EOF (Control-D) using eax, as per the rules
    84 00000044 83F8FF                      cmp eax, -1
    85 00000047 7462                        je control_d
    86                                  
    87                                      ; Check if user's input is a valid float
    88 00000049 48BF-                       mov rdi, buffer
    88 0000004B [0000000000000000] 
    89 00000053 E8(00000000)                call isfloat
    90 00000058 4883F800                    cmp rax, 0
    91 0000005C 7436                        je not_float
    92                                  
    93                                      ; Convert the valid string to a float
    94 0000005E 48BF-                       mov rdi, buffer
    94 00000060 [0000000000000000] 
    95 00000068 4831C0                      xor rax, rax
    96 0000006B E8(00000000)                call atof
    97 00000070 F2440F10F8                  movsd xmm15, xmm0 ; Save result to a non-volatile xmm register.
    98                                  
    99                                      ; Store the floating point number into the array at the correct index
   100 00000075 F2470F113CEF                movsd [r15 + r13 * 8], xmm15
   101                                  
   102                                      ; Increase the counter and loop back
   103 0000007B 49FFC5                      inc r13
   104 0000007E EBA3                        jmp check_capacity
   105                                  
   106                                  is_full:
   107                                      ; Inform user that the array is now full
   108 00000080 48BF-                       mov rdi, full_message
   108 00000082 [3E00000000000000] 
   109 0000008A 4831C0                      xor rax, rax
   110 0000008D E8(00000000)                call printf
   111 00000092 EB19                        jmp exit
   112                                  
   113                                  not_float:
   114                                      ; Inform user that the input is invalid
   115 00000094 48BF-                       mov rdi, not_a_float
   115 00000096 [0300000000000000] 
   116 0000009E 4831C0                      xor rax, rax
   117 000000A1 E8(00000000)                call printf
   118 000000A6 E978FFFFFF                  jmp check_capacity
   119                                  
   120                                  control_d:
   121 000000AB EB00                        jmp exit
   122                                  
   123                                  exit:
   124                                      ; Store the final count in rax to be returned
   125 000000AD 4C89E8                      mov rax, r13
   126                                  
   127                                  ; --- Standard Epilogue ---
   128                                  restore
    73 000000B0 9D                  <1>  popf
    74 000000B1 415F                <1>  pop r15
    75 000000B3 415E                <1>  pop r14
    76 000000B5 415D                <1>  pop r13
    77 000000B7 415C                <1>  pop r12
    78 000000B9 415B                <1>  pop r11
    79 000000BB 415A                <1>  pop r10
    80 000000BD 4159                <1>  pop r9
    81 000000BF 4158                <1>  pop r8
    82 000000C1 5E                  <1>  pop rsi
    83 000000C2 5F                  <1>  pop rdi
    84 000000C3 5A                  <1>  pop rdx
    85 000000C4 59                  <1>  pop rcx
    86 000000C5 5B                  <1>  pop rbx
    87 000000C6 5D                  <1>  pop rbp
   129 000000C7 C3                      ret
