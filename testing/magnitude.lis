     1                                  ;****************************************************************************************************************************
     2                                  ;* Program name: Arrays of floats                                                                                           *
     3                                  ;* Copyright (C) 2025 Konner Rigby.                                                                                         *
     4                                  ;* This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License  *
     5                                  ;* version 3 as published by the Free Software Foundation. This program is distributed in the hope that it will be useful,   *
     6                                  ;* but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See    *
     7                                  ;* the GNU General Public License for more details. A copy of the GNU General Public License v3 is available here:          *
     8                                  ;* <https://www.gnu.org/licenses/>.                                                                                         *
     9                                  ;****************************************************************************************************************************
    10                                  
    11                                  ;========1=========2=========3=========4=========5=========6=========7=========8=========9=========0=========1=========2=========3**
    12                                  ; Author information
    13                                  ; Author: Konner Rigby
    14                                  ; Author Email: rigbykonner@csu.fullerton.edu or rigbykonner@gmail.com
    15                                  ; CWID: 884547654
    16                                  ; Class: 240-03 Section 03
    17                                  ;
    18                                  ; Program information
    19                                  ;   Program name: Arrays of floats
    20                                  ;   Programming languages: C, x86-64 Assembly, Bash
    21                                  ;   Date program began: 2025-Sep-10
    22                                  ;   Date of last update: 2025-Sep-17
    23                                  ;   Files in this program: main.cpp, manager.asm, input_array.asm, isfloat.asm, display_array.c, append.asm, magnitude.asm,
    24                                  ;   mean.asm, r.sh.
    25                                  ;   Status: Ready for release.
    26                                  ;
    27                                  ; Purpose
    28                                  ;   This program demonstrates hybrid programming by managing arrays of floating-point numbers using both C and Assembly.
    29                                  ;
    30                                  ; This file
    31                                  ;   File name: magnitude.asm
    32                                  ;   Language: x86-64 Assembly (NASM)
    33                                  ;   Assemble: nasm -f elf64 -g -o magnitude.o magnitude.asm
    34                                  ;   Purpose: An assembly function that calculates the mathematical magnitude (Euclidean norm) of an array of floats.
    35                                  ;   The formula is sqrt(a_1^2 + a_2^2 + ... + a_n^2).
    36                                  ;========1=========2=========3=========4=========5=========6=========7=========8=========9=========0=========1=========2=========3**
    37                                  
    38                                  global magnitude
    39                                  
    40                                  segment .text
    41                                  magnitude:
    42                                      ; === Standard Prologue ===
    43 00000000 55                          push    rbp
    44 00000001 4889E5                      mov     rbp, rsp
    45 00000004 4154                        push    r12
    46 00000006 4155                        push    r13
    47 00000008 4156                        push    r14
    48                                  
    49 0000000A 4989FC                      mov     r12, rdi        ; r12 = array address (1st argument)
    50 0000000D 4989F5                      mov     r13, rsi        ; r13 = array size (2nd argument)
    51 00000010 4D31F6                      xor     r14, r14        ; r14 = loop counter, initialized to 0
    52 00000013 660F57C0                    xorpd   xmm0, xmm0      ; xmm0 = accumulator for sum of squares, initialized to 0.0
    53                                  
    54                                  sum_squares_loop:
    55 00000017 4D39EE                      cmp     r14, r13        ; Compare counter (r14) with size (r13)
    56 0000001A 7D13                        jge     calculate_sqrt  ; If counter >= size, jump to finish
    57                                  
    58                                      ; Load the current float from the array
    59 0000001C F2430F100CF4                movsd   xmm1, [r12 + r14 * 8]
    60                                  
    61                                      ; Square the number (xmm1 = xmm1 * xmm1)
    62 00000022 F20F59C9                    mulsd   xmm1, xmm1
    63                                  
    64                                      ; Add the squared number to our running total
    65 00000026 F20F58C1                    addsd   xmm0, xmm1
    66                                  
    67 0000002A 49FFC6                      inc     r14             ; Increment loop counter
    68 0000002D EBE8                        jmp     sum_squares_loop
    69                                  
    70                                  calculate_sqrt:
    71                                      ; Calculate the square root of the sum of squares
    72 0000002F F20F51C0                    sqrtsd  xmm0, xmm0      ; xmm0 = sqrt(xmm0)
    73                                  
    74                                      ; The result is now in xmm0, which is the return register for floats.
    75                                  
    76                                      ; === Standard Epilogue ===
    77 00000033 415E                        pop     r14
    78 00000035 415D                        pop     r13
    79 00000037 415C                        pop     r12
    80 00000039 5D                          pop     rbp
    81 0000003A C3                          ret
