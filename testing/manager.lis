     1                                  ;****************************************************************************************************************************
     2                                  ;* Program name: Arrays of floats                                                                                           *
     3                                  ;* Copyright (C) 2025 Konner Rigby.                                                                                         *
     4                                  ;* This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License  *
     5                                  ;* version 3 as published by the Free Software Foundation. This program is distributed in the hope that it will be useful,   *
     6                                  ;* but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See    *
     7                                  ;* the GNU General Public License for more details. A copy of the GNU General Public License v3 is available here:          *
     8                                  ;* <https://www.gnu.org/licenses/>.                                                                                         *
     9                                  ;****************************************************************************************************************************
    10                                  
    11                                  ;========1=========2=========3=========4=========5=========6=========7=========8=========9=========0=========1=========2=========3**
    12                                  ; Author information
    13                                  ; Author: Konner Rigby
    14                                  ; Author Email: rigbykonner@csu.fullerton.edu or rigbykonner@gmail.com
    15                                  ; CWID: 884547654
    16                                  ; Class: 240-03 Section 03
    17                                  ;
    18                                  ; Program information
    19                                  ;   Program name: Arrays of floats
    20                                  ;   Programming languages: C, x86-64 Assembly, Bash
    21                                  ;   Date program began: 2025-Sep-10
    22                                  ;   Date of last update: 2025-Sep-17
    23                                  ;   Files in this program: main.cpp, manager.asm, input_array.asm, isfloat.asm, display_array.c, append.asm, magnitude.asm,
    24                                  ;   mean.asm, r.sh.
    25                                  ;   Status: Ready for release.
    26                                  ;
    27                                  ; Purpose
    28                                  ;   This program demonstrates hybrid programming by managing arrays of floating-point numbers using both C and Assembly.
    29                                  ;
    30                                  ; This file
    31                                  ;   File name: manager.asm
    32                                  ;   Language: x86-64 Assembly (NASM)
    33                                  ;   Assemble: nasm -f elf64 -g -o manager.o manager.asm
    34                                  ;   Purpose: The main assembly module. It controls the program flow by calling all other functions to get input,
    35                                  ;   perform calculations, and display results.
    36                                  ;========1=========2=========3=========4=========5=========6=========7=========8=========9=========0=========1=========2=========3**
    37                                  
    38                                  
    39                                  ; manager.asm
    40                                  global manager
    41                                  extern printf, input_array, display_array, append, magnitude, mean
    42                                  extern clearerr, stdin
    43                                  
    44                                  segment .data
    45 00000000 546869732070726F67-         msg_header      db "This program will manage your arrays of 64-bit floats", 10, 0
    45 00000009 72616D2077696C6C20-
    45 00000012 6D616E61676520796F-
    45 0000001B 757220617272617973-
    45 00000024 206F662036342D6269-
    45 0000002D 7420666C6F6174730A-
    45 00000036 00                 
    46 00000037 466F72206172726179-         prompt_a        db "For array A enter a sequence of 64-bit floats separated by white space.", 10
    46 00000040 204120656E74657220-
    46 00000049 612073657175656E63-
    46 00000052 65206F662036342D62-
    46 0000005B 697420666C6F617473-
    46 00000064 207365706172617465-
    46 0000006D 642062792077686974-
    46 00000076 652073706163652E0A 
    47 0000007F 416674657220746865-                         db "After the last input press enter followed by Control+D:", 10, 0
    47 00000088 206C61737420696E70-
    47 00000091 757420707265737320-
    47 0000009A 656E74657220666F6C-
    47 000000A3 6C6F77656420627920-
    47 000000AC 436F6E74726F6C2B44-
    47 000000B5 3A0A00             
    48 000000B8 0A466F722061727261-         prompt_b        db 10, "For array B enter a sequence of 64-bit floats separated by white space.", 10
    48 000000C1 79204220656E746572-
    48 000000CA 20612073657175656E-
    48 000000D3 6365206F662036342D-
    48 000000DC 62697420666C6F6174-
    48 000000E5 732073657061726174-
    48 000000EE 656420627920776869-
    48 000000F7 74652073706163652E-
    48 00000100 0A                 
    49 00000101 416674657220746865-                         db "After the last input press enter followed by Control+D:", 10, 0
    49 0000010A 206C61737420696E70-
    49 00000113 757420707265737320-
    49 0000011C 656E74657220666F6C-
    49 00000125 6C6F77656420627920-
    49 0000012E 436F6E74726F6C2B44-
    49 00000137 3A0A00             
    50 0000013A 546865206D61676E69-         magnitude_a_msg db "The magnitude of array A is %f", 10, 0
    50 00000143 74756465206F662061-
    50 0000014C 727261792041206973-
    50 00000155 2025660A00         
    51 0000015A 546865206D61676E69-         magnitude_b_msg db "The magnitude of this array B is %f", 10, 0
    51 00000163 74756465206F662074-
    51 0000016C 686973206172726179-
    51 00000175 20422069732025660A-
    51 0000017E 00                 
    52 0000017F 0A4172726179732041-         append_msg      db 10, "Arrays A and B have been appended and given the name A⊕B.", 10
    52 00000188 20616E642042206861-
    52 00000191 7665206265656E2061-
    52 0000019A 7070656E6465642061-
    52 000001A3 6E6420676976656E20-
    52 000001AC 746865206E616D6520-
    52 000001B5 41E28A95422E0A     
    53 000001BC 41E28A954220636F6E-                         db "A⊕B contains", 10, 0
    53 000001C5 7461696E730A00     
    54 000001CC 546865206D61676E69-         magnitude_ab_msg db "The magnitude of A⊕B is %f", 10, 0
    54 000001D5 74756465206F662041-
    54 000001DE E28A95422069732025-
    54 000001E7 660A00             
    55 000001EA 546865206D65616E20-         mean_ab_msg      db "The mean of A⊕B is %f", 10, 0
    55 000001F3 6F662041E28A954220-
    55 000001FC 69732025660A00     
    56                                  
    57                                  segment .bss
    58 00000000 <res 320h>                  array_a resq 100
    59 00000320 <res 320h>                  array_b resq 100
    60 00000640 <res 640h>                  array_ab resq 200
    61 00000C80 ????????????????            size_a resq 1
    62 00000C88 ????????????????            size_b resq 1
    63 00000C90 ????????????????            magnitude_val resq 1
    64                                  
    65                                  segment .text
    66                                  manager:
    67                                      ; === Standard Prologue ===
    68 00000000 55                          push    rbp
    69 00000001 4889E5                      mov     rbp, rsp
    70 00000004 53                          push    rbx
    71 00000005 4154                        push    r12
    72 00000007 4155                        push    r13
    73 00000009 4883EC08                    sub     rsp, 8          ; Align stack and reserve 8 bytes for saving a float value
    74                                  
    75                                      ; Print header
    76 0000000D 48BF-                       mov     rdi, msg_header
    76 0000000F [0000000000000000] 
    77 00000017 4831C0                      xor     rax, rax
    78 0000001A E8(00000000)                call    printf
    79                                  
    80                                      ; === Process Array A ===
    81 0000001F 48BF-                       mov     rdi, prompt_a
    81 00000021 [3700000000000000] 
    82 00000029 4831C0                      xor     rax, rax
    83 0000002C E8(00000000)                call    printf
    84 00000031 48BF-                       mov     rdi, array_a
    84 00000033 [0000000000000000] 
    85 0000003B BE64000000                  mov     rsi, 100
    86 00000040 E8(00000000)                call    input_array
    87 00000045 48890425[800C0000]          mov     [size_a], rax
    88 0000004D 48BF-                       mov     rdi, array_a
    88 0000004F [0000000000000000] 
    89 00000057 488B3425[800C0000]          mov     rsi, [size_a]
    90 0000005F E8(00000000)                call    display_array
    91 00000064 48BF-                       mov     rdi, array_a
    91 00000066 [0000000000000000] 
    92 0000006E 488B3425[800C0000]          mov     rsi, [size_a]
    93 00000076 E8(00000000)                call    magnitude
    94 0000007B 48BF-                       mov     rdi, magnitude_a_msg
    94 0000007D [3A01000000000000] 
    95 00000085 B801000000                  mov     rax, 1
    96 0000008A E8(00000000)                call    printf
    97                                  
    98                                      ; === Clear the EOF flag from stdin before reading again ===
    99 0000008F 488B3D(00000000)            mov     rdi, [rel stdin]
   100 00000096 E8(00000000)                call    clearerr
   101                                  
   102                                      ; === Process Array B ===
   103 0000009B 48BF-                       mov     rdi, prompt_b
   103 0000009D [B800000000000000] 
   104 000000A5 4831C0                      xor     rax, rax
   105 000000A8 E8(00000000)                call    printf
   106 000000AD 48BF-                       mov     rdi, array_b
   106 000000AF [2003000000000000] 
   107 000000B7 BE64000000                  mov     rsi, 100
   108 000000BC E8(00000000)                call    input_array
   109 000000C1 48890425[880C0000]          mov     [size_b], rax
   110 000000C9 48BF-                       mov     rdi, array_b
   110 000000CB [2003000000000000] 
   111 000000D3 488B3425[880C0000]          mov     rsi, [size_b]
   112 000000DB E8(00000000)                call    display_array
   113 000000E0 48BF-                       mov     rdi, array_b
   113 000000E2 [2003000000000000] 
   114 000000EA 488B3425[880C0000]          mov     rsi, [size_b]
   115 000000F2 E8(00000000)                call    magnitude
   116 000000F7 48BF-                       mov     rdi, magnitude_b_msg
   116 000000F9 [5A01000000000000] 
   117 00000101 B801000000                  mov     rax, 1
   118 00000106 E8(00000000)                call    printf
   119                                  
   120                                      ; === Append Arrays and Process Result ===
   121 0000010B 48BF-                       mov     rdi, append_msg
   121 0000010D [7F01000000000000] 
   122 00000115 4831C0                      xor     rax, rax
   123 00000118 E8(00000000)                call    printf
   124 0000011D 48BF-                       mov     rdi, array_a
   124 0000011F [0000000000000000] 
   125 00000127 488B3425[800C0000]          mov     rsi, [size_a]
   126 0000012F 48BA-                       mov     rdx, array_b
   126 00000131 [2003000000000000] 
   127 00000139 488B0C25[880C0000]          mov     rcx, [size_b]
   128 00000141 49B8-                       mov     r8, array_ab
   128 00000143 [4006000000000000] 
   129 0000014B E8(00000000)                call    append
   130 00000150 4C8B2425[800C0000]          mov     r12, [size_a]
   131 00000158 4C032425[880C0000]          add     r12, [size_b]
   132 00000160 4D89E5                      mov     r13, r12
   133 00000163 48BF-                       mov     rdi, array_ab
   133 00000165 [4006000000000000] 
   134 0000016D 4C89EE                      mov     rsi, r13
   135 00000170 E8(00000000)                call    display_array
   136                                      
   137                                      ; Calculate magnitude and save it
   138 00000175 48BF-                       mov     rdi, array_ab
   138 00000177 [4006000000000000] 
   139 0000017F 4C89EE                      mov     rsi, r13
   140 00000182 E8(00000000)                call    magnitude            ; xmm0 holds the magnitude
   141 00000187 F20F1105(900C0000)          movsd   [rel magnitude_val], xmm0  ; Save the magnitude to memory
   142                                      
   143                                      ; Display the magnitude
   144 0000018F 48BF-                       mov     rdi, magnitude_ab_msg
   144 00000191 [CC01000000000000] 
   145 00000199 B801000000                  mov     rax, 1
   146 0000019E E8(00000000)                call    printf
   147                                      
   148                                      ; Calculate and display the mean, but don't save its return value
   149 000001A3 48BF-                       mov     rdi, array_ab
   149 000001A5 [4006000000000000] 
   150 000001AD 4C89EE                      mov     rsi, r13
   151 000001B0 E8(00000000)                call    mean
   152 000001B5 48BF-                       mov     rdi, mean_ab_msg
   152 000001B7 [EA01000000000000] 
   153 000001BF B801000000                  mov     rax, 1
   154 000001C4 E8(00000000)                call    printf
   155                                      
   156                                      ; Restore the magnitude value to xmm0 for return to main
   157 000001C9 F20F1005(900C0000)          movsd   xmm0, [rel magnitude_val]
   158                                      
   159                                      ; === Standard Epilogue ===
   160 000001D1 4883C408                    add     rsp, 8
   161 000001D5 415D                        pop     r13
   162 000001D7 415C                        pop     r12
   163 000001D9 5B                          pop     rbx
   164 000001DA 5D                          pop     rbp
   165 000001DB C3                          ret
